name: On Release
permissions:
  contents: write

on:
  workflow_call:
    inputs:
      os:
        description: "Comma separated list of OS for which the binary should be built"
        default: 'linux,darwin'
        required: false
        type: string

jobs:
  resolve-config:
    runs-on: ubuntu-latest
    outputs:
      os: $${{ steps.os.outputs.result }}
    steps:
      - id: os
        uses: actions/github-script@v6
        with:
          result-encoding: string
          script: |
            const systems = '${{ inputs.os }}'
            const osToImage = {
                'darwin': 'macos-latest',
                'linux': 'ubuntu-latest'
            }
            
            const result = systems.split(',').map(os => osToImage[os]);
            console.log(result)
            return result

  build:
    needs: [resolve-config]
    strategy:
      matrix:
        os: ${{ fromJSON(needs.resolve-config.outputs.os) }}
    runs-on: ${{ matrix.os }}
    steps:
      - name: "OS print"
        run: "uname"
